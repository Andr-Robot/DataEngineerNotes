[toc]

# 进程
进程是**资源分配的基本单位**，**进程是线程的容器**。   
**进程控制块** (Process Control Block, PCB) 描述进程的基本信息和运行状态，所谓的创建进程和撤销进程，都是指对 PCB 的操作。   
## 进程切换状态
![进程状态](https://raw.githubusercontent.com/Andr-Robot/iMarkdownPhotos/master/Res/%E8%BF%9B%E7%A8%8B%E4%BA%94%E6%80%81.jpeg)   
- 就绪状态（ready）：等待被调度
- 运行状态（running）
- 阻塞状态（waiting）：等待资源

**注意**：
- 只有就绪态和运行态可以相互转换，其它的都是单向转换。就绪状态的进程通过调度算法从而获得 CPU 时间，转为运行状态；而运行状态的进程，在分配给它的 CPU 时间片用完之后就会转为就绪状态，等待下一次调度。
- 阻塞状态是缺少需要的资源从而由运行状态转换而来，但是该资源不包括 CPU 时间，缺少 CPU 时间会从运行态转换为就绪态。

## 进程调度算法
### 批处理系统
批处理系统没有太多的用户操作，在该系统中，调度算法目标是保证吞吐量和周转时间（从提交到终止的时间）。
1. 先来先服务
2. 短作业优先
3. 最短剩余时间优先

### 交互式系统
交互式系统有大量的用户交互操作，在该系统中调度算法的目标是快速地进行响应。
4. 时间片轮转
5. 优先级调度
6. 多级反馈队列

## 进程同步机制
### 信号量
信号量（Semaphore）是一个整型变量，可以对其执行down和up操作，也就是常见的 P 和 V 操作。
- down : 如果信号量大于 0 ，执行 -1 操作；如果信号量等于 0，进程睡眠，等待信号量大于 0；
- up ：对信号量执行 +1 操作，唤醒睡眠的进程让其完成 down 操作。

如果信号量的取值只能为 0 或者 1，那么就成为了 **互斥量**（Mutex） ，0 表示临界区已经加锁，1 表示临界区解锁。

### 管程
管程(monitor)是一个程序结构，保证了同一时刻只有一个进程在管程内活动,即管程内定义的操作在同一时刻只被一个进程调用(由编译器实现)。

### 互斥
多个进程在同一时刻只有一个进程能进入临界区。

## linux下进程间通信的几种主要手段
1. 管道（Pipe）及有名管道（named pipe）：管道可用于具有亲缘关系进程间的通信，有名管道克服了管道没有名字的限制，因此，除具有管道所具有的功能外，它还允许无亲缘关系进程间的通信；
2. 信号（Signal）：信号是比较复杂的通信方式，用于通知接受进程有某种事件发生，除了用于进程间通信外，进程还可以发送信号给进程本身。
3. 报文（Message）队列（消息队列）：消息队列是存放在内核中的消息链表，每个消息队列由消息队列标识符表示。有足够权限的进程可以向队列中添加消息，被赋予读权限的进程则可以读走队列中的消息。消息队列克服了信号承载信息量少，管道只能承载无格式字节流以及缓冲区大小受限等缺点。
4. 共享内存：使得多个进程可以访问同一块内存空间，是最快的可用IPC形式。往往与其它通信机制，如信号量结合使用，来达到进程间的同步及互斥。
5. 信号量（semaphore）：主要作为进程间以及同一进程不同线程之间的同步手段。
6. 套接口（Socket）：更为一般的进程间通信机制，可用于不同机器之间的进程间通信。

## 进程同步与进程通信的区别
- 进程同步：控制多个进程按一定顺序执行；
- 进程通信：进程间传输信息。

**进程通信是一种手段，而进程同步是一种目的**。也可以说，为了能够达到进程同步的目的，需要让进程进行通信，传输一些进程同步所需要的信息。

# 死锁
## 死锁产生的原因
- 因为系统资源不足。
- 进程运行推进的顺序不合适。
- 资源分配不当等。

## 死锁的必要条件
- 互斥：每个资源要么已经分配给了一个进程，要么就是可用的。
- 占有和等待：已经得到了某个资源的进程可以再请求新的资源。
- 不可抢占：已经分配给一个进程的资源不能强制性地被抢占，它只能被占有它的进程显式地释放。
- 环路等待：有两个或者两个以上的进程组成一条环路，该环路中的每个进程都在等待下一个进程所占有的资源。

# 线程
线程是**独立调度的基本单位**。
一个进程中可以有多个线程，它们共享进程资源。线程**是程序执行流的最小单元**。一个标准的线程由**线程ID，当前指令指针(PC），寄存器集合和堆栈**组成。**每一个程序都至少有一个线程**，若程序只有一个线程，那就是程序本身。   

## 线程同步机制
### 临界区
通过对多线程的串行化来访问公共资源或一段代码，速度快，适合控制数据访问。

### 互斥（互斥量）
采用互斥对象机制。只有拥有互斥对象的线程才有访问公共资源的权限，因为互斥对象只有一个，所以能保证公共资源不会同时被多个线程访问。

### 信号量
它允许多个线程在同一时刻访问同一资源，但是需要限制在同一时刻访问此资源的最大线程数目。

### 事件
通过通知操作的方式来保持线程的同步，还可以方便实现对多个线程的优先级比较的操作。

# 进程线程的区别
1. 拥有资源   
进程是资源分配的基本单位，但是线程不拥有资源，线程可以访问隶属进程的资源。
2. 调度   
线程是独立调度的基本单位，在同一进程中，线程的切换不会引起进程切换，从一个进程内的线程切换到另一个进程中的线程时，会引起进程切换。
3. 系统开销   
由于创建或撤销进程时，系统都要为之分配或回收资源，如内存空间、I/O 设备等，所付出的开销远大于创建或撤销线程时的开销。类似地，在进行进程切换时，涉及当前执行进程 CPU 环境的保存及新调度进程 CPU 环境的设置，而线程切换时只需保存和设置少量寄存器内容，开销很小。
4. 通信方面    
进程间通信 (IPC) 需要进程同步和互斥手段的辅助，以保证数据的一致性。而线程间可以通过直接读/写同一进程中的数据段（如全局变量）来进行通信。

# 参考文献
[深刻理解Linux进程间通信（IPC）](https://www.ibm.com/developerworks/cn/linux/l-ipc/index.html)   
[进程的同步与通信，进程与线程同步的区别，进程与线程通信的区别](https://www.cnblogs.com/youngforever/p/3250270.html)   
[Linux线程同步的三种方法](https://blog.csdn.net/Shannon_ying/article/details/51280623)